

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Python API &mdash; Emissions API  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Database" href="database.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Emissions API
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-emissionsapi.autoupdater">emissionsapi.autoupdater module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-emissionsapi.config">emissionsapi.config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#emissionsapi-country-shapes-module">emissionsapi.country_shapes module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-emissionsapi.db">emissionsapi.db module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-emissionsapi.preprocess">emissionsapi.preprocess module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-emissionsapi.utils">emissionsapi.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#emissionsapi-web-module">emissionsapi.web module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-emissionsapi">Module contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#emissions-api">Emissions API</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Emissions API</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Python API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/emissionsapi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python-api">
<h1>Python API<a class="headerlink" href="#python-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-emissionsapi.autoupdater">
<span id="emissionsapi-autoupdater-module"></span><h2>emissionsapi.autoupdater module<a class="headerlink" href="#module-emissionsapi.autoupdater" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.autoupdater.generate_intervals">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.autoupdater.</span></span><span class="sig-name descname"><span class="pre">generate_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.autoupdater.generate_intervals" title="Permalink to this definition">¶</a></dt>
<dd><p>Generator for intervals between start and end in days intervals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start</strong> (<em>datetime.datetime</em>) – Starting datetime for the intervals.</p></li>
<li><p><strong>end</strong> (<em>datetime.datetime</em>) – End datetime for the intervals.</p></li>
<li><p><strong>days</strong> (<em>int</em><em>, </em><em>optional</em>) – Days for each interval, defaults to 5</p></li>
</ul>
</dd>
<dt class="field-even">Yield</dt>
<dd class="field-even"><p>Start and end date of the next interval.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.autoupdater.get_intervals_to_process">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.autoupdater.</span></span><span class="sig-name descname"><span class="pre">get_intervals_to_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_existing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.autoupdater.get_intervals_to_process" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all intervals with associated product files to process.
Intervals with existing data will be skipped.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>table</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to search for existing data.</p></li>
<li><p><strong>ignore_existing</strong> (<em>bool</em><em>, </em><em>optional</em>) – Exclude existing intervals, defaults to True</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Generator yielding the next interval.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>generator</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.autoupdater.main">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.autoupdater.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.autoupdater.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Entrypoint for running this as a module or from the binary.
Triggers the autoupdater.
The autoupdater will download and add all missing product files
of the configured products and the configured interval to the database.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.autoupdater.single_file_update">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.autoupdater.</span></span><span class="sig-name descname"><span class="pre">single_file_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">product_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">product</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.autoupdater.single_file_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a single file, add it to the database
and delete the file afterwards.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>product_file</strong> (<em>dict</em>) – Metadata of a single product file
as received from sentinal5dl.search.</p></li>
<li><p><strong>directory</strong> (<em>string</em>) – Directory to download file to.</p></li>
<li><p><strong>product</strong> (<em>dict</em>) – Type of the processed product.
An entry of emissionsapi.db.products.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-emissionsapi.config">
<span id="emissionsapi-config-module"></span><h2>emissionsapi.config module<a class="headerlink" href="#module-emissionsapi.config" title="Permalink to this headline">¶</a></h2>
<p>Load and handle Emissions API configuration.</p>
<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.config.config">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.config.</span></span><span class="sig-name descname"><span class="pre">config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.config.config" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a specific configuration value or the whole configuration, loading
the configuration file if it was not before.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>string</em>) – optional configuration key to return</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary containing the configuration or configuration value</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.config.configuration_file">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.config.</span></span><span class="sig-name descname"><span class="pre">configuration_file</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.config.configuration_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the best match for the configuration file.  The configuration file
locations taken into consideration are (in this particular order):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">./emissionsapi.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/emissionsapi.yml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/emissionsapi.yml</span></code></p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>configuration file name or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.config.update_configuration">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.config.</span></span><span class="sig-name descname"><span class="pre">update_configuration</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.config.update_configuration" title="Permalink to this definition">¶</a></dt>
<dd><p>Update configuration.</p>
</dd></dl>

</div>
<div class="section" id="emissionsapi-country-shapes-module">
<h2>emissionsapi.country_shapes module<a class="headerlink" href="#emissionsapi-country-shapes-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-emissionsapi.db">
<span id="emissionsapi-db-module"></span><h2>emissionsapi.db module<a class="headerlink" href="#module-emissionsapi.db" title="Permalink to this headline">¶</a></h2>
<p>Database layer for the Emmission API.</p>
<dl class="py class">
<dt class="sig sig-object py" id="emissionsapi.db.AlembicVersion">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">AlembicVersion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.AlembicVersion" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-obj docutils literal notranslate"><span class="pre">sqlalchemy.ext.declarative.sqlalchemy.ext.declarative.declarative_base._name</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="emissionsapi.db.Cache">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">Cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.Cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-obj docutils literal notranslate"><span class="pre">sqlalchemy.ext.declarative.sqlalchemy.ext.declarative.declarative_base._name</span></code></p>
<p>ORM object for the request cache</p>
<dl class="py method">
<dt class="sig sig-object py" id="emissionsapi.db.Cache.invalidate">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">invalidate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">earliest</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.Cache.invalidate" title="Permalink to this definition">¶</a></dt>
<dd><p>Invalidates/deletes all cached responses in the given interval to
ensure these data is generated anew. This is meant to be run when the
underlying data for this interval changes, for instance since new data
has been imported.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>earliest</strong> (<em>datetime.datetime</em>) – Earliest time of the interval to invalidate</p></li>
<li><p><strong>latest</strong> (<em>datetime.datetime</em>) – Latest time of the interval to invalidate</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="emissionsapi.db.File">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">File</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.File" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-obj docutils literal notranslate"><span class="pre">sqlalchemy.ext.declarative.sqlalchemy.ext.declarative.declarative_base._name</span></code></p>
<p>ORM object for the nc files.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.filter_query">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">filter_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wkt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">begin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.filter_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter query by time and location.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>sqlalchemy.orm.Query</em>) – SQLAlchemy Query</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to get data from</p></li>
<li><p><strong>wkt</strong> (<em>geoalchemy2.WKTElement</em><em>, </em><em>optional</em>) – WKT Element specifying an area in which to search for points,
defaults to None.</p></li>
<li><p><strong>distance</strong> (<em>float</em><em>, </em><em>optional</em>) – Distance as defined in PostGIS’ <a class="reference external" href="https://postgis.net/docs/ST_DWithin.html">ST_DWithin</a> function.</p></li>
<li><p><strong>begin</strong> (<em>datetime.datetime</em><em>, </em><em>optional</em>) – Get only points after this timestamp, defaults to None</p></li>
<li><p><strong>end</strong> (<em>datetime.datetime</em><em>, </em><em>optional</em>) – Get only points before this timestamp, defaults to None</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>SQLAlchemy Query filtered by time and location.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sqlalchemy.orm.query.Query</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.get_averages">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">get_averages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.get_averages" title="Permalink to this definition">¶</a></dt>
<dd><p>Get daily averages of all points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to get data from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>SQLAlchemy Query with tuple of the daily carbon monoxide average,
the maximal timestamp the minimal timestamp and the timestamp
truncated by day.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sqlalchemy.orm.query.Query</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.get_data_range">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">get_data_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.get_data_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the range of data currently available from the API.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to get data from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>SQLAlchemy Query requesting the minimum and maximum measurement
time from all values.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sqlalchemy.orm.query.Query</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.get_points">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">get_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.get_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to get data from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>SQLAlchemy Query returning tuples of value, timestamp, longitude,
and latitude.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sqlalchemy.orm.query.Query</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.get_session">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">get_session</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.get_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a new session.</p>
<p>Lazy load the database connection and create the tables.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>sqlalchemy.orm.session.Session – SQLAlchemy Session object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.get_statistics">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">get_statistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'day'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.get_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Get statistical data like amount, average, min, or max values for a
specified time interval. Optionally, time and location filters can be
applied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to get data from</p></li>
<li><p><strong>interval_length</strong> (<em>str</em>) – Length of the time interval for which data is being
aggregated as accepted by PostgreSQL’s <a class="reference external" href="https://postgresql.org/docs/9.1/functions-datetime.html">date_trunc</a>
function like <code class="docutils literal notranslate"><span class="pre">day</span></code> or <code class="docutils literal notranslate"><span class="pre">week</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>SQLAlchemy Query requesting the following statistical values for
the specified time interval:</p>
<ul class="simple">
<li><p>number of considered measurements</p></li>
<li><p>average product value</p></li>
<li><p>minimum product value</p></li>
<li><p>maximum product value</p></li>
<li><p>time of the first measurement</p></li>
<li><p>time of the last measurement</p></li>
<li><p>start of the interval</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sqlalchemy.orm.query.Query</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.insert_dataset">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">insert_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.insert_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Batch insert data into the database using PostGIS specific functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>data</strong> (<em>pandas.core.frame.DataFrame</em>) – DataFrame containing value, timestamp, longitude and latitude</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.ext.declarative.api.DeclarativeMeta</em>) – Base class representing the database table for the data</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.limit_offset_query">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">limit_offset_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.limit_offset_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply limit and offset to the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>sqlalchemy.orm.Query</em>) – SQLAlchemy Query</p></li>
<li><p><strong>limit</strong> (<em>int</em><em>, </em><em>optional</em>) – Limit number of Items returned, defaults to None</p></li>
<li><p><strong>offset</strong> (<em>int</em><em>, </em><em>optional</em>) – Specify the offset of the first hit to return,
defaults to None</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>SQLAlchemy Query with limit and offset applied.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sqlalchemy.orm.query.Query</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.db.with_session">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.db.</span></span><span class="sig-name descname"><span class="pre">with_session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.db.with_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for f to make a SQLAlchemy session present within the function</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>f</strong> (<em>Function</em>) – Function to call</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>e</strong> – Possible exception of f</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Result of f</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-emissionsapi.preprocess">
<span id="emissionsapi-preprocess-module"></span><h2>emissionsapi.preprocess module<a class="headerlink" href="#module-emissionsapi.preprocess" title="Permalink to this headline">¶</a></h2>
<p>Preprocess the locally stored data and store them in the database.</p>
<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.preprocess.list_ncfiles">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.preprocess.</span></span><span class="sig-name descname"><span class="pre">list_ncfiles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.preprocess.list_ncfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>list all nc files in storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>storage</strong> (<em>str</em>) – Path to the directory containing the <cite>*.nc</cite> files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Set of all unprocessed files</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>set</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.preprocess.main">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.preprocess.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.preprocess.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Entrypoint for running this as a module or from the binary.
Triggers the preprocessing of the data.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.preprocess.preprocess_file">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.preprocess.</span></span><span class="sig-name descname"><span class="pre">preprocess_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ncfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">product</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.preprocess.preprocess_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Preprocess a single file and write it to the database</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ncfile</strong> (<em>str</em>) – path to the ncfile to preprocess</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to to write data to</p></li>
<li><p><strong>product</strong> (<em>str</em>) – The name of the product to load from the files</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.preprocess.write_to_database">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.preprocess.</span></span><span class="sig-name descname"><span class="pre">write_to_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbl</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.preprocess.write_to_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Write data to the PostGIS database</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy Session</p></li>
<li><p><strong>tbl</strong> (<em>sqlalchemy.sql.schema.Table</em>) – Table to to write data to</p></li>
<li><p><strong>data</strong> (<em>pandas.core.frame.DataFrame</em>) – Data to add to the database</p></li>
<li><p><strong>filepath</strong> (<em>str</em>) – Path to the file being imported</p></li>
<li><p><strong>tbl</strong> – Table to to write data to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-emissionsapi.utils">
<span id="emissionsapi-utils-module"></span><h2>emissionsapi.utils module<a class="headerlink" href="#module-emissionsapi.utils" title="Permalink to this headline">¶</a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="emissionsapi.utils.RESTParamError">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">emissionsapi.utils.</span></span><span class="sig-name descname"><span class="pre">RESTParamError</span></span><a class="headerlink" href="#emissionsapi.utils.RESTParamError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></p>
<p>User-specific exception, used in <a class="reference internal" href="#emissionsapi.utils.polygon_to_wkt" title="emissionsapi.utils.polygon_to_wkt"><code class="xref py py-func docutils literal notranslate"><span class="pre">polygon_to_wkt()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.utils.bounding_box_to_wkt">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.utils.</span></span><span class="sig-name descname"><span class="pre">bounding_box_to_wkt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lon1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.utils.bounding_box_to_wkt" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a bounding box specified by its top-left and bottom-right
coordinates to a wkt string defining a polygon.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="emissionsapi.utils.polygon_to_wkt">
<span class="sig-prename descclassname"><span class="pre">emissionsapi.utils.</span></span><span class="sig-name descname"><span class="pre">polygon_to_wkt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polygon</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#emissionsapi.utils.polygon_to_wkt" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a list of points to a WKT string defining a polygon.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>polygon</strong> (<em>list</em>) – List of values with every pair of values representing a
consecutive vertex of the polygon.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>WKT defining the polygon.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="emissionsapi-web-module">
<h2>emissionsapi.web module<a class="headerlink" href="#emissionsapi-web-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-emissionsapi">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-emissionsapi" title="Permalink to this headline">¶</a></h2>
<div class="section" id="emissions-api">
<h3>Emissions API<a class="headerlink" href="#emissions-api" title="Permalink to this headline">¶</a></h3>
<p>Emissions API’s mission is to provide easy access to European Space Agency’s
Sentinel-5P satellite data without the need of being an expert in satellite
data analysis and without having to process terabytes of data.</p>
<dl class="field-list simple">
<dt class="field-odd">copyright</dt>
<dd class="field-odd"><p>2019, The Emissions API Developers</p>
</dd>
<dt class="field-even">url</dt>
<dd class="field-even"><p><a class="reference external" href="https://emissions-api.org">https://emissions-api.org</a></p>
</dd>
<dt class="field-odd">license</dt>
<dd class="field-odd"><p>MIT</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="database.html" class="btn btn-neutral float-left" title="Database" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019 The Emissions API Developers (https://emissions-api.org).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>